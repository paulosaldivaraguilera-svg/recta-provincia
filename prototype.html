<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recta Provincia - El Camin de la Sombra</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0808;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Georgia, serif;
            overflow: hidden;
        }
        #gameContainer { position: relative; }
        canvas {
            background: #0a0808;
            border: 4px solid #1a1210;
            display: block;
        }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            color: #8b7355;
            font-size: 14px;
            text-shadow: 2px 2px 4px #000;
        }
        #karmaBar {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 10px;
            background: #1a1410;
            border: 1px solid #2d2015;
        }
        #karmaFill {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #63b3ed, #4a3728, #6b3a3a);
            transition: width 0.3s;
        }
        #karmaLabel {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%);
            color: #5a4a3a;
            font-size: 10px;
            text-transform: uppercase;
        }
        #menu, #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 5, 3, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        #gameOver { display: none; }
        .title {
            font-size: 32px;
            color: #8b7355;
            margin-bottom: 20px;
            letter-spacing: 3px;
        }
        .subtitle {
            color: #4a3728;
            font-size: 14px;
            margin-bottom: 30px;
            font-style: italic;
        }
        .menu-btn {
            background: #2d2015;
            border: 2px solid #3d2a1d;
            color: #8b7355;
            padding: 10px 30px;
            font-size: 14px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        .menu-btn:hover {
            background: #3d2a1d;
        }
        .controls {
            color: #3d2a1d;
            font-size: 10px;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="game" width="800" height="500"></canvas>
        
        <div id="ui">
            <span id="health">Salud: 100</span>
            <span id="exp">EXP: 0</span>
            <span id="level">NV: 1</span>
        </div>
        
        <div id="karmaBar"><div id="karmaFill"></div></div>
        <div id="karmaLabel">Karma</div>
        
        <div id="menu">
            <div class="title">RECTA PROVINCIA</div>
            <div class="subtitle">"El Camin de la Sombra"</div>
            <button class="menu-btn" onclick="startGame()">COMENZAR</button>
            <div class="controls">WASD: Mover | A: Transformar | ESPACIO: Atacar | SHIFT: Correr</div>
        </div>
        
        <div id="gameOver">
            <div class="title" style="color:#8b0000">FIN DEL CAMINO</div>
            <div class="subtitle" id="endKarma">Tu destino...</div>
            <button class="menu-btn" onclick="startGame()">REINTENTAR</button>
            <button class="menu-btn" onclick="showMenu()">MENU</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        
        let state = {
            screen: 'menu',
            player: { x: 400, y: 250, width: 24, height: 40, health: 100, exp: 0, level: 1, karma: 50, transform: 'human', direction: 1 },
            enemies: [],
            particles: [],
            keys: {},
            spawnTimer: 0,
            time: 0
        };
        
        function init() {
            document.addEventListener('keydown', e => { state.keys[e.key] = true; state.keys[e.code] = true; });
            document.addEventListener('keyup', e => { state.keys[e.key] = false; state.keys[e.code] = false; });
            requestAnimationFrame(gameLoop);
        }
        
        function startGame() {
            state.screen = 'playing';
            state.player = { x: 400, y: 250, width: 24, height: 40, health: 100, maxHealth: 100, exp: 0, level: 1, karma: 50, transform: 'human', direction: 1 };
            state.enemies = [];
            state.particles = [];
            state.spawnTimer = 0;
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            updateUI();
        }
        
        function showMenu() {
            state.screen = 'menu';
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('gameOver').style.display = 'none';
        }
        
        function updateUI() {
            const p = state.player;
            document.getElementById('health').textContent = 'Salud: ' + Math.round(p.health);
            document.getElementById('exp').textContent = 'EXP: ' + p.exp;
            document.getElementById('level').textContent = 'NV: ' + p.level;
            document.getElementById('karmaFill').style.width = p.karma + '%';
        }
        
        function spawnEnemy() {
            const types = ['weka', 'piuchen', 'trauco'];
            const type = types[Math.floor(Math.random() * types.length)];
            let x, y;
            const side = Math.floor(Math.random() * 4);
            if (side === 0) { x = Math.random() * 1600; y = -30; }
            else if (side === 1) { x = 1600 + 30; y = Math.random() * 1000; }
            else if (side === 2) { x = Math.random() * 1600; y = 1000 + 30; }
            else { x = -30; y = Math.random() * 1000; }
            
            const configs = { 'weka': { h: 40, s: 1.5, d: 8, e: 20, k: -5, c: '#3d3d3d' },
                            'piuchen': { h: 80, s: 1.8, d: 12, e: 40, k: 5, c: '#2d4a2d' },
                            'trauco': { h: 35, s: 2.5, d: 18, e: 30, k: -8, c: '#4a2020' } };
            const cfg = configs[type];
            state.enemies.push({ x, y, type, health: cfg.h, maxHealth: cfg.h, speed: cfg.s, damage: cfg.d, exp: cfg.e, karmaChange: cfg.k, color: cfg.c });
        }
        
        function createParticle(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                state.particles.push({ x, y, vx: (Math.random() - 0.5) * 5, vy: (Math.random() - 0.5) * 5, life: 1, color, size: Math.random() * 4 + 2 });
            }
        }
        
        function update() {
            if (state.screen !== 'playing') return;
            
            const p = state.player;
            state.time += 0.016;
            
            let moveX = 0, moveY = 0;
            if (state.keys['ArrowLeft'] || state.keys['KeyA']) moveX = -1;
            if (state.keys['ArrowRight'] || state.keys['KeyD']) moveX = 1;
            if (state.keys['ArrowUp'] || state.keys['KeyW']) moveY = -1;
            if (state.keys['ArrowDown'] || state.keys['KeyS']) moveY = 1;
            
            const speed = (state.keys['ShiftLeft'] || state.keys['ShiftRight']) ? 4 : 2;
            if (moveX !== 0) p.direction = moveX > 0 ? 1 : -1;
            p.x += moveX * speed;
            p.y += moveY * speed;
            p.x = Math.max(20, Math.min(1580, p.x));
            p.y = Math.max(20, Math.min(980, p.y));
            
            if (state.keys['KeyA'] && !state.keys.transformA) {
                state.keys.transformA = true;
                if (p.karma > 60) p.transform = p.transform === 'alcatraz' ? 'human' : 'alcatraz';
                else if (p.karma < 40) p.transform = p.transform === 'chonchon' ? 'human' : 'chonchon';
            }
            if (!state.keys['KeyA']) state.keys.transformA = false;
            
            if ((state.keys[' '] || state.keys['Space']) && !p.attacking) {
                p.attacking = true;
                const range = p.transform === 'chonchon' ? 100 : 60;
                const damage = p.transform === 'chonchon' ? 50 : 25;
                state.enemies.forEach(e => { if (Math.hypot(e.x - p.x, e.y - p.y) < range) e.health -= damage; });
                createParticle(p.x, p.y, '#c5a059', 15);
            }
            if (!state.keys[' '] && !state.keys['Space']) p.attacking = false;
            
            state.spawnTimer++;
            if (state.spawnTimer > 60) { spawnEnemy(); state.spawnTimer = 0; }
            
            state.enemies = state.enemies.filter(e => {
                const dx = p.x - e.x, dy = p.y - e.y, dist = Math.hypot(dx, dy);
                if (dist > 5) { e.x += (dx / dist) * e.speed; e.y += (dy / dist) * e.speed; }
                if (dist < 35) p.health -= e.damage * 0.02;
                if (e.health <= 0) { p.exp += e.exp; p.karma = Math.max(10, Math.min(90, p.karma + e.karmaChange)); createParticle(e.x, e.y, e.color, 20); if (p.exp >= p.level * 100) { p.level++; p.maxHealth += 20; p.health = p.maxHealth; } updateUI(); return false; }
                return true;
            });
            
            state.particles = state.particles.filter(pt => { pt.x += pt.vx; pt.y += pt.vy; pt.life -= 0.03; return pt.life > 0; });
            
            if (p.health <= 0) {
                state.screen = 'gameover';
                let end = p.karma < 30 ? 'SOMBRA OSCURA' : p.karma > 70 ? 'LUZ SUPREMA' : 'EQUILIBRADO';
                document.getElementById('endKarma').textContent = end;
                document.getElementById('gameOver').style.display = 'flex';
            }
        }
        
        function draw() {
            const p = state.player;
            const camX = Math.max(0, Math.min(800, p.x - 400));
            const camY = Math.max(0, Math.min(500, p.y - 250));
            
            ctx.fillStyle = '#0a0808';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            state.enemies.forEach(e => {
                const ex = e.x - camX, ey = e.y - camY;
                ctx.fillStyle = e.color;
                ctx.fillRect(ex - 15, ey - 20, 30, 25);
                ctx.fillStyle = '#0a0808';
                ctx.fillRect(ex - 12, ey - 25, 24, 5);
                ctx.fillStyle = e.color;
                ctx.fillRect(ex - 12, ey - 25, 24 * (e.health / e.maxHealth), 5);
            });
            
            state.particles.forEach(pt => {
                ctx.globalAlpha = pt.life;
                ctx.fillStyle = pt.color;
                ctx.beginPath();
                ctx.arc(pt.x - camX, pt.y - camY, pt.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            const px = p.x - camX, py = p.y - camY;
            ctx.fillStyle = p.karma > 50 ? 'rgba(99, 179, 237, 0.3)' : 'rgba(61, 90, 61, 0.3)';
            ctx.beginPath();
            ctx.arc(px, py, 20, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#3d2a1d';
            ctx.fillRect(px - 12, py - 20, 24, 35);
            
            ctx.fillStyle = '#c5a059';
            ctx.beginPath();
            ctx.arc(px, py - 25, 10, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
        
        init();
    </script>
</body>
</html>
